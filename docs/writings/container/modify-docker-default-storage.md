---
title: ä¿®æ”¹Dockeré»˜è®¤å­˜å‚¨è·¯å¾„
icon: article
category:

- é—®é¢˜è§£å†³
- å®¹å™¨æŠ€æœ¯

tag:

- Docker
- Linux

---

# ä¿®æ”¹ Docker é»˜è®¤å­˜å‚¨è·¯å¾„

## é—®é¢˜å¼•å…¥

ä»Šå¤©åœ¨æœåŠ¡å™¨(æ“ä½œç³»ç»Ÿ: CentOS)ä¸Šåˆ›å»ºæ–°å®¹å™¨çš„æ—¶å€™çœ‹åˆ°å®¹å™¨åˆ›å»ºå¤±è´¥ï¼Œå¹¶æç¤ºç£ç›˜ç©ºé—´ä¸è¶³ã€‚

è¾“å…¥æŸ¥è¯¢ç£ç›˜ç©ºé—´å‘½ä»¤åå‘ç°ï¼Œ`/` ç›®å½•åªåˆ†é…äº†50Gç©ºé—´ï¼Œè€Œ `/home` ç›®å½•å´åˆ†é…äº†198Gç©ºé—´ã€‚

è€Œ Docker é»˜è®¤çš„å­˜å‚¨è·¯å¾„æ˜¯ `/var/lib/docker` ï¼Œæ˜¯åœ¨ `/` ç›®å½•ä¸‹çš„ï¼Œåœ¨ä¸ä¿®æ”¹æ“ä½œç³»ç»Ÿç£ç›˜æŒ‚è½½çš„å‰æä¸‹ï¼Œæƒ³è¦ Docker
èƒ½æ­£å¸¸ä½¿ç”¨ã€åˆ›å»ºå®¹å™¨ï¼Œæˆ‘ä»¬éœ€è¦æŠŠ Docker é»˜è®¤å­˜å‚¨è·¯å¾„ä¿®æ”¹åˆ° `/home` ç›®å½•ä¸‹ã€‚



## ä¿®æ”¹æ–¹æ³•ä¸€

ç›´æ¥ä¿®æ”¹ docker çš„å¯åŠ¨å‚æ•°

- æš‚æ—¶åœæ­¢ Docker æœåŠ¡

  ```bash
  systemctl stop docker
  ```

- ä¿é™©èµ·è§ï¼Œå†æ¬¡ç¡®è®¤ Docker çš„å­˜å‚¨è·¯å¾„

  ```bash
  docker info | grep Dir
  
  Docker Root Dir: /var/lib/docker              # dockeré»˜è®¤çš„å­˜å‚¨è·¯å¾„
  ```

- åœ¨ `/home` ç›®å½•ä¸‹æ–°å»ºå­˜å‚¨ç›®å½•

  ```bash
  mkdir -p /home/docker
  ```

- è¿ç§»åŸæœ‰æ•°æ®åˆ°æ–°ç›®å½•

  ```bash
  mv /var/lib/docker/* /home/docker
  ```

- ä¿®æ”¹ docker.service é…ç½®æ–‡ä»¶

  ```bash
  vi /usr/lib/systemd/system/docker.service
  ```

  æ‰¾åˆ°è¿™ä¸€è¡Œ

  `ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock`

  ä¿®æ”¹å¦‚ä¸‹

  `ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --graph /home/docker`

- ä½¿è¿™ä»½é…ç½®æ–‡ä»¶ç”Ÿæ•ˆ

  ```bash
  systemctl daemon-reload
  ```

- å¯åŠ¨ Docker æœåŠ¡

  ```bash
  systemctl start docker
  ```

- æŸ¥çœ‹æ˜¯å¦ä¿®æ”¹æˆåŠŸ

  ```bash
  docker info | grep Dir
  
  Docker Root Dir: /home/docker
  ```



å¦‚æœ `Docker` çš„ç‰ˆæœ¬æ˜¯ `1.12` æˆ–ä»¥ä¸Šçš„ï¼Œå¯ä»¥ä¿®æ”¹æˆ–æ–°å»º `daemon.json` æ–‡ä»¶ã€‚ä¿®æ”¹åä¼šç«‹å³ç”Ÿæ•ˆï¼Œä¸éœ€é‡å¯ `Docker` æœåŠ¡ã€‚

```bash
# ä¿®æ”¹é…ç½®æ–‡ä»¶
vi /etc/docker/daemon.json


{
    "graph": "/new-path/docker"
}
```



## ä¿®æ”¹æ–¹æ³•äºŒ

ä¸ä¿®æ”¹å¯åŠ¨å‚æ•°ï¼Œåˆ›å»ºç›®å½•çš„è½¯é“¾æ¥ï¼Œå­˜æ”¾ç›®å½•ä¾æ—§æ˜¯é‚£ä¸ªï¼Œä½†æ˜¯å®é™…å­˜æ”¾ç›®å½•å·²ç»è¢«ä¿®æ”¹äº†

- æˆ‘ä»¬çŸ¥é“åœ¨æ“ä½œç³»ç»Ÿå½“ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ `Docker` å®¹å™¨çš„å­˜æ”¾ä½ç½®åœ¨ `/var/lib/docker` ç›®å½•ä¸‹é¢ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢å‘½ä»¤æŸ¥çœ‹å…·ä½“ä½ç½®ã€‚

  ```bash
  docker info | grep Dir
  
  Docker Root Dir: /var/lib/docker
  ```

  

- è§£å†³é»˜è®¤å­˜å‚¨å®¹é‡ä¸è¶³çš„æƒ…å†µï¼Œæœ€ç›´æ¥ä¸”æœ€æœ‰æ•ˆçš„æ–¹æ³•å°±æ˜¯æŒ‚è½½æ–°çš„åˆ†åŒºåˆ°è¯¥ç›®å½•ã€‚ä½†æ˜¯åœ¨åŸæœ‰ç³»ç»Ÿç©ºé—´ä¸å˜çš„æƒ…å†µä¸‹ï¼Œæ‰€ä»¥é‡‡ç”¨è½¯é“¾æ¥çš„æ–¹å¼ï¼Œä¿®æ”¹é•œåƒå’Œå®¹å™¨çš„å­˜æ”¾è·¯å¾„è¾¾åˆ°åŒæ ·çš„ç›®çš„ã€‚

  

- åœæ‰ Docker æœåŠ¡

  ```bash
  systemctl stop docker
  ```

  

- ç„¶åç§»åŠ¨æ•´ä¸ª `/var/lib/docker` ç›®å½•åˆ°ç©ºé—´ä¸è¾ƒå¤§çš„ç›®çš„è·¯å¾„ã€‚è¿™æ—¶å€™å¯åŠ¨ `Docker` æ—¶å‘ç°å­˜å‚¨ç›®å½•ä¾æ—§æ˜¯ `/var/lib/docker` ç›®å½•ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯å­˜å‚¨åœ¨æ•°æ®ç›˜ `/data/docker` ä¸Šäº†ã€‚

  ```bash
  # ç§»åŠ¨åŸæœ‰çš„å†…å®¹
  mv /var/lib/docker /home/docker
  
  # åˆ›å»ºé“¾æ¥
  ln -sf /home/docker /var/lib/docker
  ```



æ¥ä¸‹æ¥ Docker æœåŠ¡è¿è¡Œè¿‡ç¨‹ä¸­çš„é•œåƒã€å®¹å™¨å…¨éƒ½å­˜å‚¨åˆ°ç©ºé—´æ›´å¤§çš„ `/home` ç›®å½•ä¸‹äº†ï¼Œåˆå¯ä»¥æ„‰å¿«åœ°åˆ›å»ºå®¹å™¨äº†ğŸ˜‰



å‚è€ƒé“¾æ¥ï¼šhttps://huaweicloud.csdn.net/6331127bd3efff3090b513db.html