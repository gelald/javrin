---
title: Dockerå®¹å™¨é€šä¿¡
icon: article
category:

- é—®é¢˜è§£å†³
- å®¹å™¨æŠ€æœ¯

tag:

- Docker
- ç½‘ç»œ

---

# å¦‚ä½•è®©Dockerå®¹å™¨ä¹‹é—´è¿›è¡Œç›¸äº’è®¿é—®

## é—®é¢˜å¼•å…¥

ä¹‹å‰åœ¨æ‰¾ Redis å¥½çœ‹çš„ GUI ï¼Œå‘ç°äº† Redis è‡ªå®¶çš„ WebGUIã€ŒRedisInsightã€è¿˜æ”¯æŒ Docker éƒ¨ç½² (1.11.1ç‰ˆæœ¬)ï¼Œæ‰“ç®—ä½¿ç”¨ Docker
Compose æ¥å¯åŠ¨ Redis å’Œ RedisInsight


> æœ€è¿‘ã€ŒRedisInsightã€2.xç‰ˆæœ¬çš„æ¡Œé¢å®¢æˆ·ç«¯å·²ç»æ¨å‡ºäº†ï¼Œå¯ä»¥çœ‹è¿™ç¯‡æ–‡ç« äº†è§£
> ğŸ‘‰[é¢œå€¼çˆ†è¡¨ï¼Rediså®˜æ–¹å¯è§†åŒ–å·¥å…·æ¥å•¦ï¼ŒåŠŸèƒ½çœŸå¿ƒå¼ºå¤§ï¼](https://juejin.cn/post/7072537112834211847)

æˆ‘ä»¬è¿›å…¥æ­£é¢˜

è¿™æ˜¯æˆ‘çš„ä¸¤ä»½ docker-compose.yaml æ–‡ä»¶

> å·¦è¾¹æ˜¯ RedisInsightï¼Œå³è¾¹æ˜¯ Redis çš„å®Œå…¨ä½“â€”â€” RedisMod

![](https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220519204620.png)

å¯åŠ¨åï¼Œè¿›å…¥ RedisInsight æ‰“ç®—è¿æ¥æœ¬åœ°çš„ Redisï¼Œå‘ç°æ€ä¹ˆè¿æ¥éƒ½è¿æ¥ä¸ä¸Šï¼Œåé¢åˆ¤æ–­æ˜¯ç½‘ç»œçš„é—®é¢˜ã€‚

> å› ä¸ºè™½ç„¶æœ¬æœºå¯ä»¥é€šè¿‡ 127.0.0.1:6379 è¿æ¥ Redisï¼Œä½†æ˜¯å¯¹äº RedisInsight å®¹å™¨æ¥è¯´ï¼Œæ˜¯æ— æ³•é€šè¿‡ 127.0.0.1
> è¿™ä¸ªç½‘ç»œè¿æ¥çš„ï¼Œå› ä¸ºä»–ä»¬å¤„äºçš„ç½‘ç»œæ˜¯ä¸ä¸€æ ·çš„ã€‚
>
> å› ä¸ºæœ¬æœºã€RedisModå®¹å™¨ã€RedisInsightå®¹å™¨å¯ä»¥çœ‹æˆæ˜¯å±€åŸŸç½‘å†…çš„ä¸‰ä¸ªä¸Šç½‘è®¾å¤‡ï¼Œæ‰€ä»¥ä¹Ÿå°±**æ— æ³•ç›´æ¥äº’ç›¸è¿é€š**
>
> è™½ç„¶å¯ä»¥ä½¿ç”¨æœ¬æœºçš„ IP åœ°å€è¿›è¡Œè¿æ¥ï¼Œä½†æ˜¯ IP åœ°å€ä¸èƒ½ä¿è¯ä¸å˜ï¼Œå†™ä¸€ä¸ªå›ºå®šçš„å€¼ä¹Ÿä¸çµæ´»ã€‚



é‚£æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•å¯ä»¥è®©ä¸¤ä¸ªå®¹å™¨äº’ç›¸è¿é€šäº’ç›¸è®¿é—®çš„åŒæ—¶è¿˜ä¿æŒä¸€å®šçš„çµæ´»æ€§å‘¢ï¼Ÿç­”æ¡ˆè‡ªç„¶æ˜¯æœ‰çš„



## è§£å†³æ–¹æ¡ˆ

### docker run ä½¿ç”¨ link å‚æ•°

åœ¨ä¸ä½¿ç”¨ Docker Compose çš„æ—¶å€™ï¼Œåœ¨å¯åŠ¨å‘½ä»¤ä¸­åŠ å…¥ `--link` å‚æ•°ï¼Œå°±å¯ä»¥å®ç°å®¹å™¨ä¹‹é—´çš„è®¿é—®

- å¯åŠ¨ redismod å®¹å™¨

  ```bash
  docker run --rm --name redismod -p 6379:6379 -v /data/:/data -d redislabs/redismod:latest
  ```

- å¯åŠ¨ redisinsightå®¹å™¨

  ```bash
  docker run --rm --name redisinsight -p 8001:8001 -v /db:/db --link redismod -d redislabs/redisinsight:latest
  ```

ä½¿ç”¨ `--link` ä¸­æŒ‡å®šçš„ `redismod` å³å¯æ˜ å°„åˆ° redismod çš„å®¹å™¨ç½‘ç»œä¸­

![](https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220517233054.png)

![image-20220517233113573](https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/image-20220517233113573.png)

å¯ä»¥çœ‹åˆ°æ˜¯è¿æ¥æˆåŠŸçš„



### docker compose åŒä¸€ä»½ docker-compose.yaml æ–‡ä»¶

ç›¸æ¯”ä½¿ç”¨ docker run å‘½ä»¤å¯åŠ¨å®¹å™¨ï¼Œæ˜¾ç„¶ docker compose æ‰æ˜¯æ›´ä¸ºæ¨èçš„é‚£ä¸€ä¸ªæ–¹å¼ï¼ŒæŠŠå¯åŠ¨æ‰€éœ€çš„é•œåƒã€ç¯å¢ƒç­‰å…¨éƒ½å†™åˆ°ä¸€ä»½ docker-compose.yaml æ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿ä½¿ç”¨ã€‚

å¦‚æœä½¿ç”¨ docker compose çš„æ–¹å¼ï¼Œå°±æ˜¯æŠŠä¸¤ä¸ªå®¹å™¨çš„å¯åŠ¨ä¿¡æ¯éƒ½**å†™åˆ°åŒä¸€ä»½æ–‡ä»¶ä¸­**ï¼Œå†åœ¨éœ€è¦ä¾èµ–å¦ä¸€ä¸ªå®¹å™¨çš„å®¹å™¨å¯åŠ¨ä¿¡æ¯ä¸­åŠ å…¥ depends_onã€links å‚æ•°ï¼Œè¿™æ ·å¾—åˆ°çš„ç»“æœå’Œä¸Šé¢ä½¿ç”¨ docker run çš„æ–¹å¼å¾—åˆ°çš„ç»“æœæ˜¯ä¸€æ ·çš„

![](https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220519214933.png)



### docker compose è¿æ¥åŒä¸€ä¸ªç½‘ç»œ

ä¸Šè¿°åŒä¸€ä»½ docker-compose.yaml æ–‡ä»¶çš„æ–¹æ³•è™½ç„¶å¯è¡Œï¼Œä½†æ˜¯å­˜åœ¨ä¸€å®šçš„å±€é™æ€§ï¼Œå‡å¦‚éœ€è¦é“¾æ¥ä¸€ä¸ªä½¿ç”¨ docker run è¿è¡Œçš„å®¹å™¨ï¼Œåˆæ€ä¹ˆæ ·å®ç°äº’ç›¸è®¿é—®å‘¢ï¼Ÿ

è¿™æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥è®©ä¸¤ä¸ªå®¹å™¨éƒ½è¿æ¥ç€åŒä¸€ä¸ªç½‘ç»œï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå®¹å™¨å°±ç›¸å½“äºæ˜¯è¿™ä¸ªç½‘ç»œä¸‹çš„ä¸¤ä¸ªä¸Šç½‘è®¾å¤‡ï¼Œä¹Ÿå°±å¯ä»¥å®ç°äº’é€šäº†

> å…ˆå›é¡¾ä¸€ä¸‹ Docker çš„ç½‘å¡

#### Docker ç½‘å¡ä»‹ç»

![](https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220517230048.png)

- bridgeï¼šé»˜è®¤ç½‘å¡ï¼Œç±»ä¼¼äº VMware çš„ NAT æ¨¡å¼ï¼Œå¦‚æœéœ€è¦è®¿é—®å®¹å™¨å†…éƒ¨çš„ç«¯å£éœ€è¦è¿›è¡Œç«¯å£æ˜ å°„
- hostï¼šç›´æ¥ä½¿ç”¨ä¸»æœºç½‘ç»œï¼Œç±»ä¼¼äº VMware çš„æ¡¥æ¥æ¨¡å¼ï¼Œè®¿é—®å®¹å™¨å†…éƒ¨çš„ç«¯å£æ—¶ä¸éœ€è¦è¿›è¡Œç«¯å£æ˜ å°„ï¼Œç›´æ¥è®¿é—®å³å¯ï¼Œä½†æ˜¯å¯èƒ½ä¼šä¸ä¸»æœºçš„ç«¯å£å·å†²çª
- noneï¼šç¦æ­¢æ‰€æœ‰è”ç½‘ï¼Œæ²¡æœ‰ç½‘ç»œé©±åŠ¨



#### è‡ªå®šä¹‰ç½‘ç»œ

ä½¿ç”¨ `docker network create custom-local-net` åˆ›å»ºä¸€ä¸ªåä¸º `custom-local-net` çš„ Docker ç½‘å¡ï¼Œ**é»˜è®¤æ˜¯ bridge æ¨¡å¼çš„**ï¼Œä½†æ˜¯å’Œ bridge æ¨¡å¼åˆæœ‰ä¸€å®šçš„åŒºåˆ«

è¿™ä¸ªé—®é¢˜å®˜æ–¹ç»™å‡ºäº†è§£é‡Šï¼š

> **User-defined bridges provide automatic DNS resolution between containers**.
> Containers on the default bridge network can only access each other by IP addresses, unless you use the --link option, which is considered legacy. On a user-defined bridge network, containers can resolve each other by name or alias.

è¿™ä¸€æ®µè¯å®˜æ–¹ç»™å‡ºäº†ä¸å°‘çš„ä¿¡æ¯é‡ï¼š

1. ç”¨æˆ·è‡ªå®šä¹‰çš„ç½‘ç»œæ˜¯åŸºäº bridge çš„ï¼Œå¹¶ä¸”**å®¹å™¨é—´å¯ä»¥é€šè¿‡å®¹å™¨åæˆ–åˆ«åè¿›è¡Œè‡ªåŠ¨ DNS ç›¸äº’è§£æçš„åŠŸèƒ½**ï¼
2. ä½¿ç”¨é»˜è®¤çš„ bridge ç½‘ç»œä»…ä»…èƒ½é€šè¿‡å„è‡ªçš„ IP åœ°å€æ¥è¿›è¡Œé€šä¿¡ï¼Œ**é™¤éä½¿ç”¨ `--link` é€‰é¡¹**
3. **`--link` é€‰é¡¹**å®ç°çš„å®¹å™¨ç›¸äº’è®¿é—®åŠŸèƒ½å·²ç»è¢«å®˜æ–¹è®¤å®š**æ˜¯è¿‡æ—¶çš„**

ç”± 1. å¯ä»¥å¾—çŸ¥ï¼Œä½¿ç”¨è‡ªå®šä¹‰ç½‘ç»œå°±èƒ½å®ç°å®¹å™¨é—´ç›¸äº’é€šä¿¡çš„åŠŸèƒ½ï¼



#### å®ç°

é“ºå«äº†è¿™ä¹ˆå¤šï¼Œè¯¥åˆ°å®è·µé˜¶æ®µäº†

`custom-local-net` å·²ç»è¢«åˆ›å»ºäº†ï¼Œæ‰€ä»¥åœ¨ docker-compose.yaml æ–‡ä»¶ä¸­ç›´æ¥æŒ‡å®šå³å¯

ä¸ºäº†åŒºåˆ«äºä¸Šé¢çš„ç°è±¡ï¼Œå¯¹æœåŠ¡åè¿›è¡Œä¸€å®šçš„ä¿®æ”¹

![](https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220730222223.png)

å…¶ä¸­åœ¨ docker-compose.yaml æ–‡ä»¶ä¸­ä½¿ç”¨å¤–éƒ¨ç½‘ç»œéœ€è¦å£°æ˜/åˆ›å»º

- åˆ›å»ºå¹¶ä½¿ç”¨ï¼Œå¦‚æœæ²¡æœ‰æ‰‹åŠ¨ä½¿ç”¨ `docker network create` å‘½ä»¤ï¼Œéœ€è¦åœ¨ä½¿ç”¨å‰åˆ›å»º

  ```yaml
  services:
  	xxx:
  		networks:
  			- new_net
  networks:
  	new_net:
  		# å£°æ˜ä½¿ç”¨çš„ç½‘ç»œæ˜¯ä½¿ç”¨ bridge é©±åŠ¨æ¥åˆ›å»ºçš„
  		driver: bridge
  ```

  

- å£°æ˜å¹¶ä½¿ç”¨ï¼Œå¦‚æœåœ¨å¤–é¢å·²ç»æ‰‹åŠ¨åˆ›å»ºäº†ç½‘ç»œï¼Œåœ¨ docker-compose.yaml æ–‡ä»¶ä¸­åªéœ€å£°æ˜ä¸€ä¸‹å³å¯

  ```yaml
  services:
  	xxx:
  		networks:
  			- created_net
  networks:
  	created_net:
  		# å£°æ˜ä½¿ç”¨çš„ç½‘ç»œæ˜¯å¤–éƒ¨åˆ›å»ºçš„
  		external: true
  ```

![](https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220519223001.png)

![](https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220519223021.png)

æœ€ç»ˆä¹Ÿæ˜¯å®ç°äº†è®¿é—® redismod çš„ç½‘ç»œ

## æ€»ç»“

Docker å®¹å™¨ä¹‹é—´ç›¸äº’è®¿é—®æ˜¯å®é™…ç”Ÿäº§ä¸­éš¾ä»¥ç»•å¼€çš„ä¸€é“åï¼Œè¯šç„¶å¯ä»¥ä½¿ç”¨æ¡¥æ¥æ¨¡å¼ï¼Œä½†æ˜¯æ¡¥æ¥æ¨¡å¼ä¸å¤ªåˆ©äºç¯å¢ƒçš„è¿ç§»ã€‚æ˜¾ç„¶ä½¿ç”¨èƒ½è‡ªåŠ¨
DNS è§£æçš„ç½‘ç»œæ¨¡å¼ä¼šæ›´ä¸ºçµæ´»ï¼Œä¹Ÿæ›´ä¸ºä¼˜é›…ã€‚
