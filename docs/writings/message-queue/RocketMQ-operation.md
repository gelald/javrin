# RocketMQ 操作落地

## RocketMQ 普通消息发送

### 普通消息同步发送
### 普通消息异步发送
### 普通消息单向发送





## RocketMQ 消息消费模式

### 集群消费模式
如果一个消费者组内有多个消费者，它们订阅同一个Topic的消息，当队列中有消息到来时，RocketMQ 会「雨露均沾」地分发这些消息给各个消费者，消费者均摊这些消息，这些消息只会被投放到具体一个消费者实例，消息只会被消费一次，默认的模式，消费进度存储在Broker中，可靠性更高

### 广播消费模式
如果一个消费者组内有多个消费者，它们订阅同一个Topic的消息，当队列中有消息到来时，这些消息都会被投放到每一个消费者实例上。这种消费模式下，消费进度不会保存到Broker中，而是持久化到消费者实例中，因为消息被复制成多分给多个消费者进行消费了，消费进度只和消费者实例相关。消息重复消费的风险会变大，不支持顺序消费，无法重置消费位点，当消费者客户端重启，会丢失重启时间段内传到RocketMQ的消息，一般情况不推荐使用


## RocketMQ 顺序消息
生产者按照顺序把消息发送到RocketMQ，然后RocketMQ按照投递消息的顺序把消息投递给消费者消费

### 生产全局顺序消息
只创建一个Queue

### 生产局部顺序消息
对消息指定一个具体的Queue，这些消息在局部上是有序的，正如购买手机、衣服时，两种商品都需要经过下订单、扣库存、付款的流程，商品的这些流程是有顺序要求的，但是两种商品之间的流程是没有关联的，所以可以处理成局部有序的

### 顺序消费消息
MessageListenerOrderly接口

异常，不能设置为RECONSUME_LATER，放到重试队列就无法保证顺序性


## RocketMQ 延时消息
生产者把消息发送给RocketMQ时，不希望RocketMQ立马把消息投递到消费者，而是延迟一定的时间，再投递，这种消息就是延时消息

场景：限时订单等

## RocketMQ 批量消息
当有大批量的消息需要发送时，生产者还是一条一条地发，会出现系统瓶颈，可以把这些消息放到一个集合里面，一次性发送一个集合所有消息

但是批量消息也有限制，一次发送的组装后的消息不能超过4MB，所以需要按数量打包，比如每100条打包成一份就先把这100条消息批量发送了

如果一开始就把所有的消息组装成一个集合，那么就需要进行拆分，拆分成每个大小约为1MB的消息集合，再进行发送



## RocketMQ 过滤消息

### Tag 过滤
发送消息时传入tag，消费者订阅消息时，指定订阅某些Tag，比较简单

### SQL 过滤
使用一些类似SQL语句的语法进行过滤 is null、between等关键词，有难度，但是灵活

