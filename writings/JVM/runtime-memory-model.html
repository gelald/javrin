<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.24" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.94" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme="dark"] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Java 运行时内存模型","image":["https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220318171130.png","https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220321145051.png","https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220321152233.png","https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220321152545.png","https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220321163452.png","https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220321171230.png","https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/007S8ZIlgy1gfsrktwl9jj30y50u0x6q.jpg","https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220323112201.png","https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220323143146.png"],"dateModified":"2025-09-07T08:25:53.000Z","author":[{"@type":"Person","name":"gelald","url":"https://github.com/gelald"}]}</script><meta property="og:url" content="https://gelald.github.io/javrin/javrin/writings/JVM/runtime-memory-model.html"><meta property="og:site_name" content="Javrin"><meta property="og:title" content="Java 运行时内存模型"><meta property="og:description" content="Java 运行时内存模型 内存是非常重要的系统资源，是硬盘和 CPU 的中间仓库及桥梁，承载着操作系统和应用程序的实时运行。JVM 内存布局规定了 Java 在运行过程中内存申请、分配、管理的策略，保证了 JVM 的高效稳定运行。 JVM运行时数据区大致包括以下五个部分 程序计数器 虚拟机栈 本地方法栈 方法区 堆 JVM 整体架构 Java 虚拟机定..."><meta property="og:type" content="article"><meta property="og:image" content="https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220318171130.png"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2025-09-07T08:25:53.000Z"><meta property="article:modified_time" content="2025-09-07T08:25:53.000Z"><link rel="icon" href="/javrin/avataaars.ico"><title>Java 运行时内存模型 | Javrin</title><meta name="description" content="Java 运行时内存模型 内存是非常重要的系统资源，是硬盘和 CPU 的中间仓库及桥梁，承载着操作系统和应用程序的实时运行。JVM 内存布局规定了 Java 在运行过程中内存申请、分配、管理的策略，保证了 JVM 的高效稳定运行。 JVM运行时数据区大致包括以下五个部分 程序计数器 虚拟机栈 本地方法栈 方法区 堆 JVM 整体架构 Java 虚拟机定...">
    <link rel="preload" href="/javrin/assets/style-qo7zO4aX.css" as="style"><link rel="stylesheet" href="/javrin/assets/style-qo7zO4aX.css">
    <link rel="modulepreload" href="/javrin/assets/app-CMSzRw1X.js"><link rel="modulepreload" href="/javrin/assets/runtime-memory-model.html-CIzjiDW0.js"><link rel="modulepreload" href="/javrin/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/javrin/assets/index.html-C0P8Rt5_.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-BzXSqfqT.js" as="script"><link rel="prefetch" href="/javrin/assets/RocketMQ-learning.html-CSpU-Mdy.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-CfTgsh6k.js" as="script"><link rel="prefetch" href="/javrin/assets/KeyCloak-custom-Authentication.html-CIP6zRHO.js" as="script"><link rel="prefetch" href="/javrin/assets/CMS收集器.html-BDmUBUQE.js" as="script"><link rel="prefetch" href="/javrin/assets/G1收集器.html-5_jJXY9W.js" as="script"><link rel="prefetch" href="/javrin/assets/Java内存模型与并发.html-O110ogkH.js" as="script"><link rel="prefetch" href="/javrin/assets/class-bytecode.html-D-Sfonzr.js" as="script"><link rel="prefetch" href="/javrin/assets/class-loading.html-C3QaIaBe.js" as="script"><link rel="prefetch" href="/javrin/assets/garbage-collection.html-CQM2rSpH.js" as="script"><link rel="prefetch" href="/javrin/assets/jvm-remote-monitor.html-DpgKCF93.js" as="script"><link rel="prefetch" href="/javrin/assets/metrics-gc-issue.html-BRtDIztF.js" as="script"><link rel="prefetch" href="/javrin/assets/内存分析.html-jIYndQ69.js" as="script"><link rel="prefetch" href="/javrin/assets/物理内存模型.html-DK8mwqMg.js" as="script"><link rel="prefetch" href="/javrin/assets/线程堆栈分析.html-mxEKgS8c.js" as="script"><link rel="prefetch" href="/javrin/assets/Object.html-BO8laNnl.js" as="script"><link rel="prefetch" href="/javrin/assets/String.html-DTxme0Ae.js" as="script"><link rel="prefetch" href="/javrin/assets/data-and-operation.html-Ca67pSTb.js" as="script"><link rel="prefetch" href="/javrin/assets/generic.html-BLL5FMEo.js" as="script"><link rel="prefetch" href="/javrin/assets/interface-and-abstract.html-MyfuXZvU.js" as="script"><link rel="prefetch" href="/javrin/assets/interview-summary.html-B9n6c9Ll.js" as="script"><link rel="prefetch" href="/javrin/assets/lambda-and-functional.html-D9cQLE3o.js" as="script"><link rel="prefetch" href="/javrin/assets/object-oriented.html-neDspn4q.js" as="script"><link rel="prefetch" href="/javrin/assets/reflection.html-D63HQ7ta.js" as="script"><link rel="prefetch" href="/javrin/assets/spi.html-D-JIlArI.js" as="script"><link rel="prefetch" href="/javrin/assets/throwable.html-DuNz8Ue8.js" as="script"><link rel="prefetch" href="/javrin/assets/ArrayDeque.html-DvOBzy67.js" as="script"><link rel="prefetch" href="/javrin/assets/ArrayList.html-C1l_nbKO.js" as="script"><link rel="prefetch" href="/javrin/assets/HashMap-and-HashSet.html-BYdEs9jj.js" as="script"><link rel="prefetch" href="/javrin/assets/LinkedHashMap-and-LinkedHashSet.html-C7yBAg71.js" as="script"><link rel="prefetch" href="/javrin/assets/LinkedList.html-CZn8qM7q.js" as="script"><link rel="prefetch" href="/javrin/assets/PriorityQueue.html-BYwVnnb4.js" as="script"><link rel="prefetch" href="/javrin/assets/TreeMap-and-TreeSet.html-mXxYevl_.js" as="script"><link rel="prefetch" href="/javrin/assets/stream.html-CR3gFSag.js" as="script"><link rel="prefetch" href="/javrin/assets/summary.html-BkEtknws.js" as="script"><link rel="prefetch" href="/javrin/assets/MongoDB-GridFS.html-CVuMQxny.js" as="script"><link rel="prefetch" href="/javrin/assets/MyBatis-Plus-start.html-DZfU7sYD.js" as="script"><link rel="prefetch" href="/javrin/assets/MyBatis-cache.html-Cij26zR1.js" as="script"><link rel="prefetch" href="/javrin/assets/MyBatis-get-param.html-BK4Pcr6J.js" as="script"><link rel="prefetch" href="/javrin/assets/MyBatis-start.html-Cvl1HhGR.js" as="script"><link rel="prefetch" href="/javrin/assets/MySQL-batch-insert.html-CbSosuIH.js" as="script"><link rel="prefetch" href="/javrin/assets/MySQL-data-type.html-Ck42KY24.js" as="script"><link rel="prefetch" href="/javrin/assets/MySQL-index-2.html-C7t8-lgV.js" as="script"><link rel="prefetch" href="/javrin/assets/MySQL-index.html-C1IZ8EIX.js" as="script"><link rel="prefetch" href="/javrin/assets/MySQL-optimization-1.html-B9Ube1_k.js" as="script"><link rel="prefetch" href="/javrin/assets/MySQL-optimization-2.html-_FDpQgf-.js" as="script"><link rel="prefetch" href="/javrin/assets/MySQL-paging-query.html-DnqgRxU6.js" as="script"><link rel="prefetch" href="/javrin/assets/MySQL-process-InnoDB.html-BCWf2puw.js" as="script"><link rel="prefetch" href="/javrin/assets/MySQL-process-Server.html-D03PBbl5.js" as="script"><link rel="prefetch" href="/javrin/assets/MySQL-start.html-swuWj6Uq.js" as="script"><link rel="prefetch" href="/javrin/assets/MySQL-transaction.html-WonKERl5.js" as="script"><link rel="prefetch" href="/javrin/assets/Redis-data-type.html-CnRRSGah.js" as="script"><link rel="prefetch" href="/javrin/assets/Redis-distributed-lock.html-BK4r0v6n.js" as="script"><link rel="prefetch" href="/javrin/assets/Redis-interview.html-Ssy7RnXi.js" as="script"><link rel="prefetch" href="/javrin/assets/Untitled.html-BBVmeeG4.js" as="script"><link rel="prefetch" href="/javrin/assets/MessageQueue.html-CGrJIXX6.js" as="script"><link rel="prefetch" href="/javrin/assets/RabbitMQ.html-D5jAqbz3.js" as="script"><link rel="prefetch" href="/javrin/assets/RocketMQ-broker-config.html-CF4yq5Ek.js" as="script"><link rel="prefetch" href="/javrin/assets/RocketMQ-interview.html-BYbJquhT.js" as="script"><link rel="prefetch" href="/javrin/assets/RocketMQ-operation-client.html-mv5wtzX3.js" as="script"><link rel="prefetch" href="/javrin/assets/RocketMQ-operation-starter.html-BxsfpJD-.js" as="script"><link rel="prefetch" href="/javrin/assets/RocketMQ-start.html-lNBFFGIl.js" as="script"><link rel="prefetch" href="/javrin/assets/RocketMQ-theory-1.html-D0iTCS1F.js" as="script"><link rel="prefetch" href="/javrin/assets/RocketMQ-theory-2.html-CU2ypJBZ.js" as="script"><link rel="prefetch" href="/javrin/assets/RocketMQ.html-CZxqMbrH.js" as="script"><link rel="prefetch" href="/javrin/assets/Spring_SpringBoot.html-DGCJEc9d.js" as="script"><link rel="prefetch" href="/javrin/assets/Spring-AOP.html-Krx7NW1F.js" as="script"><link rel="prefetch" href="/javrin/assets/Spring-IoC.html-rWApw0rN.js" as="script"><link rel="prefetch" href="/javrin/assets/Spring-annotation.html-BNeJH0ME.js" as="script"><link rel="prefetch" href="/javrin/assets/Spring-schedule.html-BLRrrgz6.js" as="script"><link rel="prefetch" href="/javrin/assets/Spring-thread-pool.html-wYQOOKJg.js" as="script"><link rel="prefetch" href="/javrin/assets/SpringBoot-core-component.html-B75QwlLj.js" as="script"><link rel="prefetch" href="/javrin/assets/SpringBoot-develop.html-BQKDjMO4.js" as="script"><link rel="prefetch" href="/javrin/assets/SpringMVC.html-BQhpJwrO.js" as="script"><link rel="prefetch" href="/javrin/assets/Spring注解编程.html-BYluhcAQ.js" as="script"><link rel="prefetch" href="/javrin/assets/dynamic-schedule.html-DoayVaJe.js" as="script"><link rel="prefetch" href="/javrin/assets/filter-and-interceptor.html-B9Uwjiha.js" as="script"><link rel="prefetch" href="/javrin/assets/hot-data-init.html-CuFUiYAP.js" as="script"><link rel="prefetch" href="/javrin/assets/interview-summary.html-BET2_WDE.js" as="script"><link rel="prefetch" href="/javrin/assets/pretty-controller.html-5wDO5oaq.js" as="script"><link rel="prefetch" href="/javrin/assets/手写Spring.html-tV69_RNu.js" as="script"><link rel="prefetch" href="/javrin/assets/SpringCloud-OpenFeign.html-BbdA89hq.js" as="script"><link rel="prefetch" href="/javrin/assets/SpringCloud.html-BHxfxdjn.js" as="script"><link rel="prefetch" href="/javrin/assets/SpringCloudAlibaba.html-BAVlaVai.js" as="script"><link rel="prefetch" href="/javrin/assets/SpringCloudGateway.html-BOfbFlnW.js" as="script"><link rel="prefetch" href="/javrin/assets/SpringCloudZookeeper.html-CK1lDIWx.js" as="script"><link rel="prefetch" href="/javrin/assets/sth.html-Dp-ttOgf.js" as="script"><link rel="prefetch" href="/javrin/assets/JWT.html-DIIEtzHn.js" as="script"><link rel="prefetch" href="/javrin/assets/OAuth2.html-C121EVOZ.js" as="script"><link rel="prefetch" href="/javrin/assets/SSO.html-941k4onU.js" as="script"><link rel="prefetch" href="/javrin/assets/SpringSecurity.html-MhIVbE9i.js" as="script"><link rel="prefetch" href="/javrin/assets/binary-search.html-BCWDMTXc.js" as="script"><link rel="prefetch" href="/javrin/assets/binary-tree-traversal.html-BbE9mo7k.js" as="script"><link rel="prefetch" href="/javrin/assets/dynamic-programming.html-Cfw_TmiV.js" as="script"><link rel="prefetch" href="/javrin/assets/fibonacci.html-BGpBR898.js" as="script"><link rel="prefetch" href="/javrin/assets/moore-voting.html-DxE55D1a.js" as="script"><link rel="prefetch" href="/javrin/assets/Algorithm.html-DhJ8feF8.js" as="script"><link rel="prefetch" href="/javrin/assets/HashMap.html-hQAbce0K.js" as="script"><link rel="prefetch" href="/javrin/assets/IO.html-BghkadDc.js" as="script"><link rel="prefetch" href="/javrin/assets/JVM.html-B7qpCzjS.js" as="script"><link rel="prefetch" href="/javrin/assets/JavaEE.html-CN2VF38p.js" as="script"><link rel="prefetch" href="/javrin/assets/JavaSE.html-BD06XArC.js" as="script"><link rel="prefetch" href="/javrin/assets/MyBatis.html-DMnNq-vb.js" as="script"><link rel="prefetch" href="/javrin/assets/Nginx.html-CcSRewPU.js" as="script"><link rel="prefetch" href="/javrin/assets/PrimaryKey.html-DHXsEBBw.js" as="script"><link rel="prefetch" href="/javrin/assets/Redis.html-BVhS274_.js" as="script"><link rel="prefetch" href="/javrin/assets/SpringDataJpa.html-B4g-vZmk.js" as="script"><link rel="prefetch" href="/javrin/assets/Swagger.html-mDWARfQt.js" as="script"><link rel="prefetch" href="/javrin/assets/XML.html-hrH3L2EH.js" as="script"><link rel="prefetch" href="/javrin/assets/并发.html-qiFgFvfV.js" as="script"><link rel="prefetch" href="/javrin/assets/接口.html-CJ99GiCD.js" as="script"><link rel="prefetch" href="/javrin/assets/服务.html-DNtKbIK6.js" as="script"><link rel="prefetch" href="/javrin/assets/集合.html-CJhbi9dB.js" as="script"><link rel="prefetch" href="/javrin/assets/is-thread-executed-in-executor.html-DS1rtzLP.js" as="script"><link rel="prefetch" href="/javrin/assets/serial-to-parallel.html-peM2xskx.js" as="script"><link rel="prefetch" href="/javrin/assets/thread-base.html-asA2tUiF.js" as="script"><link rel="prefetch" href="/javrin/assets/thread-pool.html-DFmVwBNZ.js" as="script"><link rel="prefetch" href="/javrin/assets/container-communication.html-Dsy8Vy_i.js" as="script"><link rel="prefetch" href="/javrin/assets/docker.html-ICsYK45c.js" as="script"><link rel="prefetch" href="/javrin/assets/modify-docker-default-storage.html-BdzJbL7z.js" as="script"><link rel="prefetch" href="/javrin/assets/CAP-theory.html-Ck7u-VgT.js" as="script"><link rel="prefetch" href="/javrin/assets/distributed-lock-zookeeper.html-B0777Aow.js" as="script"><link rel="prefetch" href="/javrin/assets/distributed-lock.html-NIt8qsF9.js" as="script"><link rel="prefetch" href="/javrin/assets/distributed-transaction.html-BMNKxOm2.js" as="script"><link rel="prefetch" href="/javrin/assets/adapter.html-BrWek38g.js" as="script"><link rel="prefetch" href="/javrin/assets/bridge.html-BBUV-zbn.js" as="script"><link rel="prefetch" href="/javrin/assets/builder.html-B5Bt8rK0.js" as="script"><link rel="prefetch" href="/javrin/assets/chain-of-responsibility.html-CkBaN3z-.js" as="script"><link rel="prefetch" href="/javrin/assets/composite.html-BT8Aw8wg.js" as="script"><link rel="prefetch" href="/javrin/assets/delegate.html-DkytCetk.js" as="script"><link rel="prefetch" href="/javrin/assets/design-pattern-summary.html-DdvZNchR.js" as="script"><link rel="prefetch" href="/javrin/assets/design-principle.html-BUeOMjK5.js" as="script"><link rel="prefetch" href="/javrin/assets/factory.html-BEm7ji1A.js" as="script"><link rel="prefetch" href="/javrin/assets/flyweight.html-CsxTWXQ1.js" as="script"><link rel="prefetch" href="/javrin/assets/observer.html-qJHXFv1T.js" as="script"><link rel="prefetch" href="/javrin/assets/prototype.html-Pq7S6_wg.js" as="script"><link rel="prefetch" href="/javrin/assets/proxy.html-D-PMOcuN.js" as="script"><link rel="prefetch" href="/javrin/assets/singleton.html-M0Phx2HB.js" as="script"><link rel="prefetch" href="/javrin/assets/strategy.html-4mzSUSKG.js" as="script"><link rel="prefetch" href="/javrin/assets/template.html-B99Vr450.js" as="script"><link rel="prefetch" href="/javrin/assets/中介者模式.html-jNrFW7XV.js" as="script"><link rel="prefetch" href="/javrin/assets/命令模式.html-BGa8Mpbn.js" as="script"><link rel="prefetch" href="/javrin/assets/备忘录模式.html-DvUVGzYy.js" as="script"><link rel="prefetch" href="/javrin/assets/状态模式.html-B7tQE2iA.js" as="script"><link rel="prefetch" href="/javrin/assets/装饰器模式.html-B6C-zyoG.js" as="script"><link rel="prefetch" href="/javrin/assets/解释器模式.html-BSDgRjEF.js" as="script"><link rel="prefetch" href="/javrin/assets/访问者模式.html-CAq4oqbh.js" as="script"><link rel="prefetch" href="/javrin/assets/迭代器模式.html-CJ3_NviX.js" as="script"><link rel="prefetch" href="/javrin/assets/门面模式.html-CMrQRq4h.js" as="script"><link rel="prefetch" href="/javrin/assets/Git.html-BiezAe4l.js" as="script"><link rel="prefetch" href="/javrin/assets/Maven.html-BDCxvanz.js" as="script"><link rel="prefetch" href="/javrin/assets/UML.html-CM4LuR7t.js" as="script"><link rel="prefetch" href="/javrin/assets/Bean自动映射.html-DmjKSAJu.js" as="script"><link rel="prefetch" href="/javrin/assets/Linux.html-BVbUMjLO.js" as="script"><link rel="prefetch" href="/javrin/assets/Network.html-BiKhNrK_.js" as="script"><link rel="prefetch" href="/javrin/assets/综合案例事后.html-B78zsWVH.js" as="script"><link rel="prefetch" href="/javrin/assets/404.html-k28D4PSC.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-C4aP8mvM.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-D8pzWy5O.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-Dlt_xFqQ.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-B44XGF_-.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-C9H6YfLD.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-Dy0qk6JU.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-C8JWSE9a.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-DRTmKCc2.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-DLr0DuUf.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-C7OPNfNM.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-D-8V0x4x.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-BsoLxIg8.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-DoazbglZ.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-BXMVLLSG.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-BQzzgNfU.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-Cu9J_uU5.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-DAl9sn2A.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-DgQk0c9J.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-D4CSG1kW.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-DOIDznIX.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-B9cptuuB.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-C_ngsbML.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-DOqHNJED.js" as="script"><link rel="prefetch" href="/javrin/assets/index.html-BxgdmbVN.js" as="script"><link rel="prefetch" href="/javrin/assets/photoswipe.esm-CKV1Bsxh.js" as="script"><link rel="prefetch" href="/javrin/assets/giscus-BACEvYzX.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">跳至主要內容</a><!--]--><!--[--><div class="theme-container external-link-icon has-toc" vp-container><!--[--><header id="navbar" class="vp-navbar" vp-navbar><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><a class="route-link vp-brand" href="/javrin/" aria-label="带我回家"><img class="vp-nav-logo" src="/javrin/logo.svg" alt><!----><span class="vp-site-name hide-in-pad">Javrin</span></a><!--]--></div><div class="vp-navbar-center"><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/javrin/" aria-label="主页"><!--[--><i class="vp-icon fas fa-home" sizing="height"></i><!--]-->主页<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link route-link-active auto-link" href="/javrin/writings/" aria-label="博客文章"><!--[--><i class="vp-icon fas fa-list" sizing="height"></i><!--]-->博客文章<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link auto-link" href="/javrin/learning/" aria-label="学习项目"><!--[--><i class="vp-icon fas fa-computer" sizing="height"></i><!--]-->学习项目<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="auto-link external-link" href="https://theme-hope.vuejs.press/zh/" aria-label="主题文档" rel="noopener noreferrer" target="_blank"><!--[--><i class="vp-icon fas fa-link" sizing="height"></i><!--]-->主题文档<!----></a></div></nav><!--]--></div><div class="vp-navbar-end"><!--[--><!----><div class="vp-nav-item vp-action"><a class="vp-action-link" href="https://github.com/gelald/javrin" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" name="github" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!----><!--]--><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar" vp-sidebar><!----><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/javrin/" aria-label="主页"><!--[--><i class="vp-icon fas fa-home fa-fw" sizing="both"></i><!--]-->主页<!----></a></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable active"><i class="vp-icon fas fa-list fa-fw" sizing="both"></i><a class="route-link route-link-active auto-link vp-sidebar-title no-external-link-icon" href="/javrin/writings/" aria-label="博客文章"><!---->博客文章<!----></a><!----></p><ul class="vp-sidebar-links"><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">Java基础</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">Java集合</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">设计模式</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">JVM</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/javrin/writings/JVM/class-bytecode.html" aria-label="Java 类字节码详解"><!--[--><i class="vp-icon fas fa-note-sticky fa-fw" sizing="both"></i><!--]-->Java 类字节码详解<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/javrin/writings/JVM/class-loading.html" aria-label="Java 类加载机制"><!--[--><i class="vp-icon fas fa-note-sticky fa-fw" sizing="both"></i><!--]-->Java 类加载机制<!----></a></li><li><a class="route-link route-link-active auto-link vp-sidebar-link active" href="/javrin/writings/JVM/runtime-memory-model.html" aria-label="Java 运行时内存模型"><!--[--><i class="vp-icon fas fa-note-sticky fa-fw" sizing="both"></i><!--]-->Java 运行时内存模型<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/javrin/writings/JVM/garbage-collection.html" aria-label="垃圾回收基础"><!--[--><i class="vp-icon fas fa-note-sticky fa-fw" sizing="both"></i><!--]-->垃圾回收基础<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/javrin/writings/JVM/jvm-remote-monitor.html" aria-label="JVM 远程监控"><!--[--><i class="vp-icon fas fa-note-sticky fa-fw" sizing="both"></i><!--]-->JVM 远程监控<!----></a></li><li><a class="route-link auto-link vp-sidebar-link" href="/javrin/writings/JVM/metrics-gc-issue.html" aria-label="Metrics NaN 问题追踪"><!--[--><i class="vp-icon fas fa-note-sticky fa-fw" sizing="both"></i><!--]-->Metrics NaN 问题追踪<!----></a></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">并发</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">Spring框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">MyBatis框架</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">MySQL</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">MongoDB</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">RocketMQ</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">分布式相关</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">容器技术</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">项目工具</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-book fa-fw" sizing="both"></i><span class="vp-sidebar-title">算法</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><i class="vp-icon fas fa-layer-group fa-fw" sizing="both"></i><span class="vp-sidebar-title">值得学习的文章</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><p class="vp-sidebar-header clickable"><i class="vp-icon fas fa-computer fa-fw" sizing="both"></i><a class="route-link auto-link vp-sidebar-title no-external-link-icon" href="/javrin/learning/" aria-label="学习项目"><!---->学习项目<!----></a><!----></p><ul class="vp-sidebar-links"><li><a class="route-link auto-link vp-sidebar-link" href="/javrin/learning/RocketMQ-learning.html" aria-label="RocketMQ-Learning 项目介绍"><!--[--><i class="vp-icon fas fa-article fa-fw" sizing="both"></i><!--]-->RocketMQ-Learning 项目介绍<!----></a></li></ul></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><i class="vp-icon fas fa-note-sticky" sizing="height"></i>Java 运行时内存模型</h1><div class="page-info"><span class="page-author-info" aria-label="作者🖊" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="page-author-item" href="https://github.com/gelald" target="_blank" rel="noopener noreferrer">gelald</a></span><span property="author" content="gelald"></span></span><!----><span class="page-date-info" aria-label="写作日期📅" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span data-allow-mismatch="text">2023/2/28</span><meta property="datePublished" content="2023-02-28T15:20:13.000Z"></span><span class="page-category-info" aria-label="分类🌈" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color7" role>JVM</span><!--]--><meta property="articleSection" content="JVM"></span><!----><span class="page-word-info" aria-label="字数🔠" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon" name="word"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>约 5521 字</span><meta property="wordCount" content="5521"></span><span class="page-reading-time-info" aria-label="阅读时间⌛" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>大约 18 分钟</span><meta property="timeRequired" content="PT18M"></span></div><hr></div><!----><div class="" vp-content><!----><div id="markdown-content"><h1 id="java-运行时内存模型" tabindex="-1"><a class="header-anchor" href="#java-运行时内存模型"><span>Java 运行时内存模型</span></a></h1><p>内存是非常重要的系统资源，是硬盘和 CPU 的中间仓库及桥梁，承载着操作系统和应用程序的实时运行。JVM 内存布局规定了 Java 在运行过程中内存申请、分配、管理的策略，保证了 JVM 的高效稳定运行。</p><p>JVM运行时数据区大致包括以下五个部分</p><ul><li>程序计数器</li><li>虚拟机栈</li><li>本地方法栈</li><li>方法区</li><li>堆</li></ul><h2 id="jvm-整体架构" tabindex="-1"><a class="header-anchor" href="#jvm-整体架构"><span>JVM 整体架构</span></a></h2><p><img src="https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220318171130.png" alt=""></p><p>Java 虚拟机定义了若干种程序运行期间会使用到的运行时数据区，其中有一些会随着虚拟机启动而创建，随着虚拟机退出而销毁。另外一些则是与线程一一对应的，这些与线程一一对应的数据区域会随着线程开始和结束而创建和销毁。</p><ul><li>线程私有：程序计数器、虚拟机栈、本地方法栈</li><li>线程共享：方法区、堆、堆外内存（Java7的永久代、Java8的元空间）</li></ul><p>下面来逐一分析</p><h2 id="程序计数器" tabindex="-1"><a class="header-anchor" href="#程序计数器"><span>程序计数器</span></a></h2><p>程序计数寄存器存储指令相关的线程信息，JVM 中的程序计数寄存器并不是广义上的物理寄存器，只是对物理程序计数寄存器的一种抽象模拟</p><p>程序计数器是一块比较小的内存，可以看作是当前线程所执行的字节码的<strong>行号指示器</strong>，<strong>它是唯一一个在 JVM 规范中没有规定任何 <code>OutOfMemoryError</code> 情况的区域</strong></p><h3 id="作用" tabindex="-1"><a class="header-anchor" href="#作用"><span>作用</span></a></h3><p>PC 寄存器用来存储指向下一条指令的地址，即将要执行的指令代码。字节码解释器工作时就是通过改变这个计数器的值来选取下一条需要执行的字节码指令</p><p><img src="https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220321145051.png" alt=""></p><p>关于字节码文件解析可以看：<a class="route-link" href="/javrin/writings/JVM/docs/JVM/%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6.html">Java字节码文件</a></p><blockquote><p>为什么需要程序计数器？</p></blockquote><p>因为CPU需要不停的切换各个线程，这时候切换回来以后，就得知道接着从哪开始继续执行。JVM的字节码解释器就需要通过改变程序计数寄存器的值来明确下一条应该执行什么样的字节码指令。</p><blockquote><p>程序计数寄存器为什么设定为线程私有？</p></blockquote><p>其实通过上面那个问题可以大致了解，在多线程环境下，一个时间内CPU只能执行某一个线程方法，这样也就有频繁的中断与恢复的过程，JVM为了可以精准记录各个线程正在执行的字节码指令地址，所以为每个线程都分配了一个独立的程序计数寄存器</p><h2 id="虚拟机栈" tabindex="-1"><a class="header-anchor" href="#虚拟机栈"><span>虚拟机栈</span></a></h2><h3 id="概述" tabindex="-1"><a class="header-anchor" href="#概述"><span>概述</span></a></h3><p>概念：每一个线程创建的时候都会创建一个虚拟机栈，其内部保存着一个个栈帧，对应每一个方法的调用，是<strong>线程私有的</strong></p><p>作用：保存方法的局部变量、部分结果，并参与方法的调用和返回</p><p>容量方面：JVM 规范允许 Java 虚拟机栈的大小可以是动态或者固定不变的</p><ul><li>如果采用固定大小的 Java 虚拟机栈，那每个线程的 Java 虚拟机栈容量可以在线程创建的时候独立选定。如果线程请求分配的栈容量超过 Java 虚拟机栈允许的最大容量，JVM 将会抛出一个 <strong>StackOverflowError</strong> 异常</li><li>如果采用动态大小的 Java 虚拟机栈，并且在尝试扩展的时候无法申请到足够的内存，或者在创建新的线程时没有足够的内存去创建对应的 Java 虚拟机栈，那 JVM 将会抛出一个 <strong>OutOfMemoryError</strong> 异常</li></ul><p>可以通过参数 <code>-Xss</code> 来设置线程的最大栈空间，<strong>栈的大小直接决定了函数调用的最大可达深度</strong>。</p><p>存储格式：</p><ul><li>栈中的数据都是由栈帧的格式存在</li><li>栈帧是一个内存区块，维系着方法执行过程中的各种数据信息</li><li>每个线程上正在执行的每个方法都各自对应一个栈帧</li></ul><h3 id="栈运行原理" tabindex="-1"><a class="header-anchor" href="#栈运行原理"><span>栈运行原理</span></a></h3><ul><li><p>压栈：方法调用。出栈：<strong>使用 return 语句进行正常的方法返回或方法抛出异常</strong></p></li><li><p>在一条活动线程中，一个时间点上，只会有一个活动的栈帧。即只有当前正在执行的方法的栈帧（<strong>栈顶栈帧</strong>、<strong>当前栈帧</strong>）是有效的。执行引擎运行的所有字节码指令只针对当前栈帧进行操作</p></li><li><p>如果当前方法调用了其他方法，对应的新的栈帧会被创建出来，放在栈的顶端，称为新的当前栈帧</p></li><li><p>如果当前方法调用了其他方法，方法返回之际，当前栈帧会传回此方法的执行结果给前一个栈帧，接着，虚拟机会丢弃当前栈帧，使得前一个栈帧重新成为当前栈帧</p></li></ul><p>在 IDEA 中 debug 的时候，可以在 Frame 选项卡看到当前线程的虚拟机栈的情况</p><p><img src="https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220321152233.png" alt=""></p><h3 id="栈帧的内部结构" tabindex="-1"><a class="header-anchor" href="#栈帧的内部结构"><span>栈帧的内部结构</span></a></h3><p>栈、栈帧内部存储结构图</p><p><img src="https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220321152545.png" alt=""></p><p>每个栈帧中存放着</p><ul><li>局部变量表</li><li>操作数栈</li><li>方法返回地址</li><li>动态链接</li><li>附加信息</li></ul><h4 id="局部变量表" tabindex="-1"><a class="header-anchor" href="#局部变量表"><span>局部变量表</span></a></h4><ul><li><p>局部变量表主要是存储方法的参数和定义在方法内部的局部变量。基本数据类型存储数值，引用类型存储对象的地址</p></li><li><p>局部变量表中的变量只在当前方法调用中有效，方法调用结束后，局部变量表会随着栈帧的销毁而销毁</p></li><li><p>参数值的存放总是在局部变量数组的 index0 开始，到数组长度 -1 的索引结束</p></li></ul><h5 id="槽-slot" tabindex="-1"><a class="header-anchor" href="#槽-slot"><span>槽 Slot</span></a></h5><ul><li>Slot 是局部变量表中最基本的存储单元</li><li>在局部变量表中，32位以内的类型只占用一个 Slot，64位的类型占用两个连续的 Slot <ul><li>boolean、byte、short、char 在存储前会转换为 int</li><li>long、double 占据两个 Slot</li></ul></li><li>JVM 会为局部变量表中的每一个 Slot 都分配一个访问索引，通过这个索引可以成功访问到局部变量表中指定的局部变量值</li><li>如果一个局部变量过了其作用域，那么在其作用域之后申明的新的局部变量就很有可能会复用过期局部变量的槽位，从而<strong>达到节省资源的目的</strong></li><li>如果当前帧是由构造方法或实例方法创建的，那么<strong>该对象引用 this 将会存放在 index 为 0 的 Slot 处</strong>，其余的参数按照参数表顺序继续排列（这里就引出一个问题：静态方法中为什么不可以引用 this，就是因为this 变量不存在于当前方法的局部变量表中）</li><li><strong>局部变量表中的变量也是重要的垃圾回收根节点，只要被局部变量表中直接或间接引用的对象都不会被回收</strong></li></ul><h4 id="操作数栈" tabindex="-1"><a class="header-anchor" href="#操作数栈"><span>操作数栈</span></a></h4><ul><li>操作数栈主要是保存计算过程的中间结果，作为计算过程中变量临时的存储空间</li><li>操作数栈就是 JVM 执行引擎的一个工作区，当一个方法刚开始执行的时候，一个新的栈帧也会随之被创建出来，<strong>此时这个方法的操作数栈是空的</strong></li><li><strong>如果被调用的方法带有返回值的话，其返回值将会被压入当前栈帧的操作数栈中</strong>，并更新 PC 寄存器中下一条需要执行的字节码指令</li></ul><h5 id="栈顶缓存-top-of-stack-cashing" tabindex="-1"><a class="header-anchor" href="#栈顶缓存-top-of-stack-cashing"><span>栈顶缓存 Top-of-stack-Cashing</span></a></h5><ul><li><p>HotSpot 的执行引擎采用的并非是基于寄存器的架构，但这并不代表 HotSpot VM 的实现并没有间接利用到寄存器资源。寄存器是物理 CPU 中的组成部分之一，它同时也是 CPU 中非常重要的高速存储资源。一般来说，寄存器的读/写速度非常迅速，甚至可以比内存的读/写速度快上几十倍不止，不过寄存器资源却非常有限，不同平台下的CPU 寄存器数量是不同和不规律的。寄存器主要用于缓存本地机器指令、数值和下一条需要被执行的指令地址等数据。</p></li><li><p>基于栈式架构的虚拟机所使用的零地址指令更加紧凑，但完成一项操作的时候必然需要使用更多的入栈和出栈指令，这同时也就意味着将需要更多的指令分派（instruction dispatch）次数和内存读/写次数。由于操作数是存储在内存中的，因此频繁的执行内存读/写操作必然会影响执行速度。为了解决这个问题，HotSpot JVM 设计者们提出了栈顶缓存技术，<strong>将栈顶元素全部缓存在物理 CPU 的寄存器中，以此降低对内存的读/写次数，提升执行引擎的执行效率</strong></p></li></ul><h4 id="方法返回地址" tabindex="-1"><a class="header-anchor" href="#方法返回地址"><span>方法返回地址</span></a></h4><ul><li><p>方法返回地址主要是用于保存调用该方法的程序计数寄存器的值。无论方法是正常返回还是抛出异常，在方法退出后都需要回到该方法被调用的位置。</p></li><li><p>本质上方法退出就是当前栈帧出栈的过程，此时，需要恢复上层方法的局部变量表、操作数栈、将返回值压入调用者栈帧的操作数栈、设置程序计数寄存器值等，让调用者方法继续执行下去。</p></li></ul><h4 id="动态链接" tabindex="-1"><a class="header-anchor" href="#动态链接"><span>动态链接</span></a></h4><ul><li><p>动态链接主要是指向运行时常量池中所属方法的引用</p></li><li><p>每一个栈帧内存都包含一个指向运行时常量池中该栈帧所属方法的引用，包含这个引用的目的就是为了支持当前方法的代码能够实现动态链接(Dynamic Linking)。比如invokedynamic 指令</p></li><li><p>在 Java 源文件被编译到字节码文件中时，所有的变量和方法引用都作为<strong>符号引用</strong>保存在 class 文件的常量池中。比如：描述一个方法调用了另外的其他方法时，就是通过常量池中指向方法的符号引用来表示的，那么<strong>动态链接的作用就是为了将这些符号引用转换为调用方法的直接引用</strong></p></li><li><p>方法调用不同于方法执行，方法调用阶段的唯一任务就是确定调用哪一个方法，暂时还不涉及方法内部的具体运行过程。一切方法调用在 class文件里面存储的都是<strong>符号引用</strong>，而不是方法在实际运行时内存布局中的入口地址（<strong>直接引用</strong>）。也就是需要在类加载阶段，甚至到运行期才能确定目标方法的直接引用。</p></li></ul><h2 id="本地方法栈" tabindex="-1"><a class="header-anchor" href="#本地方法栈"><span>本地方法栈</span></a></h2><p>Java 虚拟机栈用于管理 Java 方法的调用，而本地方法栈用于管理本地方法(native)的调用。除此之外，本地方法栈和虚拟机栈区别不大</p><h2 id="堆" tabindex="-1"><a class="header-anchor" href="#堆"><span>堆</span></a></h2><blockquote><p>栈解决的是程序的运行问题，即如何处理数据。堆解决的是数据存储的问题，即数据怎么放、放在哪。</p></blockquote><p>对于大多数应用，Java 堆是 Java 虚拟机管理的内存中最大的一块，被所有线程共享。此内存区域的唯一目的就是存放对象实例，几乎所有的对象实例以及数据都在这里分配内存。另外<strong>字符串常量池也设置在堆内存中</strong>。</p><h3 id="堆内存划分" tabindex="-1"><a class="header-anchor" href="#堆内存划分"><span>堆内存划分</span></a></h3><p>为了进行高效的垃圾回收，虚拟机把堆内存<strong>逻辑上</strong>划分成三块区域（分代的目的是优化 GC 性能）</p><ul><li>新生代：新对象和没达到一定年龄的对象都在新生代 <ul><li>Eden区</li><li>Survivor 0</li><li>Survivor 1</li></ul></li><li>老年代：被长时间使用的对象，老年代的内存空间应该要比新生代更大</li><li>元空间（JDK1.8 之前叫永久代）：一些方法中的操作临时对象等，JDK1.8 之前是占用 JVM 内存，JDK1.8 之后直接使用物理内存</li></ul><p>JVM 规范规定，Java 堆只需要逻辑上是连续的即可。实现时，既可以是固定大小，也可以是可扩展的，主流虚拟机都是可扩展的（通过 <code>-Xmx</code> 和 <code>-Xms</code> 控制），如果堆中没有完成实例分配，并且堆无法再扩展时，就会抛出 <code>OutOfMemoryError</code> 异常。</p><p>Java 堆内存结构</p><p><img src="https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220321163452.png" alt=""></p><p><img src="https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220321171230.png" alt=""></p><h3 id="新生代" tabindex="-1"><a class="header-anchor" href="#新生代"><span>新生代</span></a></h3><p>新生代被分为三个部分——伊甸园（<strong>Eden Memory</strong>）和两个幸存区（<strong>Survivor Memory</strong>，被称为from/to或s0/s1），默认比例是 <code>8:1:1</code></p><p>大多数新创建的对象都位于 Eden 内存空间中，当 Eden 区被填满后，会触发 Minor GC</p><p>Eden区实现回收的策略</p><ul><li>可以被回收的对象直接回收，幸存对象会转移到 Survivor 区</li><li>Survivor 区有s0/s1两块空间，分别表示正在使用和未被使用的状态。每次 Minor GC 时，将幸存对象转移到 Survivor 区中未使用的那块空间，然后将当前正在使用的空间完全清除，交换两块空间使用状态。</li><li>如果 Minor GC 要转移的对象大于 Survivor 区容量的上限，会转移到老年代</li><li>另外s0/s1中交换次数达到阈值的对象也会转移到老年代。可以通过 <code>-XX:MaxTenuringThreshold</code> 配置晋升到老年代的交换次数的阈值，默认是15</li></ul><h3 id="老年代" tabindex="-1"><a class="header-anchor" href="#老年代"><span>老年代</span></a></h3><p>老年代包含那些经过许多轮 Minor GC 后仍然存活的对象和一些大对象。（大对象是指需要大量连续内存空间的对象，这样做的目的是避免在 Eden 区和两个Survivor 区之间发生大量的内存拷贝）</p><p>当老年代空间被填满后，会触发 Major GC，<strong>Major GC 通常会花费更多的时间</strong></p><h3 id="创建一个新对象的内存分配流程" tabindex="-1"><a class="header-anchor" href="#创建一个新对象的内存分配流程"><span>创建一个新对象的内存分配流程</span></a></h3><p><img src="https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/007S8ZIlgy1gfsrktwl9jj30y50u0x6q.jpg" alt=""></p><h3 id="堆内存与-oom" tabindex="-1"><a class="header-anchor" href="#堆内存与-oom"><span>堆内存与 OOM</span></a></h3><p>Java 堆内存的大小可以通过 <code>-Xmx</code> 和 <code>-Xms</code> 来设定</p><ul><li><code>-Xms</code> = <code>-XX:InitialHeapSize</code>，表示堆的起始内存，默认是电脑内存大小/64</li><li><code>-Xmx</code> = <code>-XX:MaxHeapSize</code>，表示堆的最大内存，默认是电脑内存大小/4</li></ul><p>如果堆内存大小超过 <code>-Xmx</code> 设定值，就会抛出 <code>OutOfMemoryError</code> 异常</p><p>我们通常会把 <code>-Xms</code> 和 <code>-Xmx</code> 两个参数配置为相同的值，目的就是为了能够在垃圾回收后，堆内存不需要重新分隔计算堆的大小，从而提升性能。</p><h4 id="查看堆内存分配情况" tabindex="-1"><a class="header-anchor" href="#查看堆内存分配情况"><span>查看堆内存分配情况</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">java</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -XX:+PrintFlagsFinal</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -version</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> | </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">grep</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HeapSize</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    uintx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ErgoHeapSizeLimit</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">             =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">               {product}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    uintx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HeapSizePerGCThread</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">           =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 87241520</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">        {product}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    uintx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> InitialHeapSize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">              :=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 134217728</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       {product}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    uintx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> LargePageHeapSizeThreshold</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">    =</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 134217728</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">       {product}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">    uintx</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> MaxHeapSize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">                  :=</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2147483648</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">      {product}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">java</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> version</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;1.8.0_211&quot;</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Java(TM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) SE Runtime Environment (</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">build</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 1.8.0_211-b12</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">Java</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> HotSpot</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">TM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">64-Bit</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> Server</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> VM</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> (build </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">25.211-b12,</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mixed</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mode</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">)</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>默认情况下新生代和老年代的比例是 <code>1:2</code>，可以通过 <code>-XX:NewRatio</code> 来配置</p><p>默认情况下新生代中的 <code>Eden:From Survivor:To Survivor</code> 的比例是 <code>8:1:1</code>，可以通过 <code>-XX:SurvivorRatio</code> 来配置</p><h3 id="tlab" tabindex="-1"><a class="header-anchor" href="#tlab"><span>TLAB</span></a></h3><p>TLAB(Thread Local Allocation Buffer) 是 JVM 在 Eden 区为每一个线程分配的一个私有缓存区域。这个区域只是内存模型的角度来看，与垃圾回收无关。</p><p>因为堆内存是所有线程共享的，任何线程都可以读写堆内存中的共享数据。但是在并发环境下从堆内存中划分内存空间可能有线程安全的问题，为了避免多个线程操作同一个地址而需要加索导致影响分配速度的问题，JVM 在 Eden 区中为每一个线程都划分了一个小空间，为了提升内存分配的吞吐量，这种内存分配方式我们成为<strong>快速分配策略</strong></p><p>我们可以通过 <code>-XX:UseTLAB</code> 来设置是否开启 TLAB 空间。默认情况下 TLAB 空间是非常小的，仅占 Eden 区空间的 1%，我们可以通过 <code>-XX:TLABWasteTargetPercent</code> 来设置 TLAB 空间占 Eden 区空间的比例</p><h2 id="方法区" tabindex="-1"><a class="header-anchor" href="#方法区"><span>方法区</span></a></h2><p>方法区（method area）<strong>只是 JVM 规范中定义的一个概念</strong>，用于存储类信息、常量池、静态变量、JIT编译后的代码等数据，并没有规定如何去实现它，不同的厂商有不同的实现。</p><h3 id="永久代与元空间" tabindex="-1"><a class="header-anchor" href="#永久代与元空间"><span>永久代与元空间</span></a></h3><p><strong>永久代和元空间都可以理解为是方法区的落地实现</strong></p><p>不同厂家对方法区有不同的实现，永久代是 jdk1.8 以前对方法区的实现，元空间是 jdk 1.8 及之后对方法区的实现</p><h4 id="为什么抛弃永久代" tabindex="-1"><a class="header-anchor" href="#为什么抛弃永久代"><span>为什么抛弃永久代</span></a></h4><ul><li>永久代和新生代、老年代地址是连续的，受垃圾回收管理，这片区域的内存回收目标主要是针对常量池的回收和对类型的卸载，一般来说这个区域的回收效果比较难令人满意。</li><li>随着动态类加载的情况越来越多，这块内存我们变得不太可控，为永久代设置空间大小也是很难确定的。因为这其中有很多影响因素，比如类的总数，常量池的大小和方法数量等（jdk1.7以前字符串常量池还是纳入了永久代的空间）</li></ul><h4 id="元空间的诞生" tabindex="-1"><a class="header-anchor" href="#元空间的诞生"><span>元空间的诞生</span></a></h4><p>jdk1.8使用元空间来实现方法区，基于永久代的弊端，元空间使用的是本地内存，所以发生 <code>OutOfMemoryError</code> 的情况变少了</p><p>元空间对方法区中的数据存放是这么分配的：</p><ul><li>字符串常量池、静态变量移至堆内存中</li><li>类型信息、属性信息、方法信息、运行时常量池存到元空间中（本地内存）</li></ul><h3 id="方法区内存与-oom" tabindex="-1"><a class="header-anchor" href="#方法区内存与-oom"><span>方法区内存与 OOM</span></a></h3><p>在 Java 8，Hotspot 虚拟机对方法区的实现是元空间，所以调整方法区内存大小可以通过参数 <code>-XX:MetaspaceSize</code> 和 <code>-XX:MaxMetaspaceSize</code></p><p>默认值会依赖于平台，Windwos 下 <code>-XX:MetaspaceSize</code> 是 21 M，<code>-XX:MaxMetaspaceSize</code> 是 -1，即没有限制。</p><h3 id="方法区内部结构" tabindex="-1"><a class="header-anchor" href="#方法区内部结构"><span>方法区内部结构</span></a></h3><blockquote><p>方法区用于存储已被虚拟机加载的类型信息、常量、静态变量等</p></blockquote><h4 id="类型信息" tabindex="-1"><a class="header-anchor" href="#类型信息"><span>类型信息</span></a></h4><p>对于每一个加载的类型（类、接口、枚举、注解），JVM必须在方法区存储以下信息</p><ul><li>全限定类名</li><li>直接父类的全限定类名（对于接口和Object没有父类）</li><li>修饰符</li><li>直接接口的一个有序列表</li></ul><h4 id="属性信息" tabindex="-1"><a class="header-anchor" href="#属性信息"><span>属性信息</span></a></h4><ul><li>属性的修饰符、类型、名称</li><li>属性的声明顺序</li></ul><h4 id="方法信息" tabindex="-1"><a class="header-anchor" href="#方法信息"><span>方法信息</span></a></h4><ul><li>方法的修饰符、返回类型、名称、参数列表</li><li>方法的字符码、操作数栈、局部变量表及大小（abstract、native方法除外）</li><li>异常表，包括每个异常处理的开始位置、结束位置、代码处理在程序计数器中的偏移地址、被捕获的异常类的常量池索引（abstract、native方法除外）</li></ul><p><strong>栈、堆、方法区的交互关系</strong></p><p><img src="https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220323112201.png" alt=""></p><h4 id="运行时常量池" tabindex="-1"><a class="header-anchor" href="#运行时常量池"><span>运行时常量池</span></a></h4><p>运行时常量池（Runtime Constant Pool）是方法区的一部分，理解运行时常量池的话，需要先从字节码文件中的常量池（常量池表）说起</p><p>字节码文件中的常量池看这篇文章：<a class="route-link" href="/javrin/writings/JVM/docs/JVM/%E5%AD%97%E8%8A%82%E7%A0%81%E6%96%87%E4%BB%B6.html">JVM-字节码文件详解</a></p><blockquote><p>使用常量池的原因</p></blockquote><p>Java 中的字节码需要数据支持，通常这种数据会很大以至于不能直接存到字节码里，换另一种方式，可以存到常量池，方法字符码中包含了指向常量池的引用。常量池可以看作是一张表，虚拟机指令根据这张常量表找到要执行的类名、方法名、参数类型、字面量等类型</p><blockquote><p>运行时常量池的引入</p></blockquote><p>常量池中的各种字面量和符号引用在类加载后存放到方法区的运行时常量池中。JVM 为每一个类或接口都维护一个常量池，池中的数据像数组一样，通过索引进行访问。如果构造运行时常量池所需的内存空间超过了方法区所能提供的最大值，则会抛出 <code>OutOfMemoryError</code> 异常。</p><p>运行时常量池中包含各种不同的常量。包括编译期就已经明确的数值字面量；也包括到运行期解析后才能够获得的方法或字段引用；甚至运行期间也可以将新的常量放入池中，如：String 中的 <code>intern()</code> 方法。</p><h5 id="字符串常量池" tabindex="-1"><a class="header-anchor" href="#字符串常量池"><span>字符串常量池</span></a></h5><p>字符串常量池可以理解为是分担了部分运行时常量池的工作。字符串耗费高昂的时间与空间代价，大量频繁的创建字符串，极大程度地影响程序的性能，为了提高性能和减少内存开销，在实例化字符串常量的时候进行了一些优化，为字符串开辟一个缓存区。实现该优化的基础是因为字符串是不可变的，可以不用担心数据冲突进行共享。</p><p>直接使用双引号声明：<code>String str1=“abc”;</code> JVM 会直接返回该字符串的引用 使用 <code>String str2 = new String(“abc”);</code> 方式，会在堆中创建一个 <code>String(“abc”)</code> 对象实例，将字符串常量池中这个&quot;abc&quot;字符串的引用地址返回赋给<code>String(“abc”)</code></p><p><img src="https://wingbun-notes-image.oss-cn-guangzhou.aliyuncs.com/images/20220323143146.png" alt=""></p></div><!----><!----><!----></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link vp-meta-label" href="https://github.com/gelald/javrin/edit/main/docs/writings/JVM/runtime-memory-model.md" aria-label="编辑此页" rel="noopener noreferrer" target="_blank"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon" name="edit"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->编辑此页<!----></a></div><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">最近更新</span><time class="vp-meta-info" datetime="2025-09-07T08:25:53.000Z" data-allow-mismatch>2025/9/7 08:25</time></div><div class="contributors"><span class="vp-meta-label">贡献者: </span><!--[--><!--[--><span class="vp-meta-info" title="email: yb.ng@foxmail.com">gelald</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link auto-link prev" href="/javrin/writings/JVM/class-loading.html" aria-label="Java 类加载机制"><div class="hint"><span class="arrow start"></span>上一页</div><div class="link"><i class="vp-icon fas fa-note-sticky" sizing="height"></i>Java 类加载机制</div></a><a class="route-link auto-link next" href="/javrin/writings/JVM/garbage-collection.html" aria-label="垃圾回收基础"><div class="hint">下一页<span class="arrow end"></span></div><div class="link">垃圾回收基础<i class="vp-icon fas fa-note-sticky" sizing="height"></i></div></a></nav><div id="comment" class="giscus-wrapper input-top vp-comment" vp-comment style="display:block;"><div style="display: flex;align-items: center;justify-content: center;height: 96px"><span style="--loading-icon: url(&quot;data:image/svg+xml;utf8,%3Csvg xmlns=&#39;http://www.w3.org/2000/svg&#39; preserveAspectRatio=&#39;xMidYMid&#39; viewBox=&#39;25 25 50 50&#39;%3E%3CanimateTransform attributeName=&#39;transform&#39; type=&#39;rotate&#39; dur=&#39;2s&#39; keyTimes=&#39;0;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;360&#39;%3E%3C/animateTransform%3E%3Ccircle cx=&#39;50&#39; cy=&#39;50&#39; r=&#39;20&#39; fill=&#39;none&#39; stroke=&#39;currentColor&#39; stroke-width=&#39;4&#39; stroke-linecap=&#39;round&#39;%3E%3Canimate attributeName=&#39;stroke-dasharray&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;1,200;90,200;1,200&#39;%3E%3C/animate%3E%3Canimate attributeName=&#39;stroke-dashoffset&#39; dur=&#39;1.5s&#39; keyTimes=&#39;0;0.5;1&#39; repeatCount=&#39;indefinite&#39; values=&#39;0;-35px;-125px&#39;%3E%3C/animate%3E%3C/circle%3E%3C/svg%3E&quot;);--icon-size: 48px;display: inline-block;width: var(--icon-size);height: var(--icon-size);background-color: currentcolor;-webkit-mask-image: var(--loading-icon);mask-image: var(--loading-icon)"></span></div></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper" vp-footer><!----><div class="vp-copyright">Copyright © 2025 gelald </div></footer></div><!--]--><!--]--><!--[--><!----><!--[--><!--]--><!--]--><!--]--></div>
    <script type="module" src="/javrin/assets/app-CMSzRw1X.js" defer></script>
  </body>
</html>
